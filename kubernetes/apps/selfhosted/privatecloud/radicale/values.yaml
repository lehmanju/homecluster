---
# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s-labs/helm-charts/refs/heads/main/charts/other/app-template/schemas/helmrelease-helm-v2.schema.json

controllers:
  radicale:
    containers:
      main:
        image:
          repository: docker.io/tomsquest/docker-radicale
          tag: 3.5.5.0@sha256:0c26cce308d63b3af01f4a3ea1f66246a23c2ead7c1987d5cc7284073d3719d5
        resources:
          limits:
            memory: 128Mi
          requests:
            cpu: 10m
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            { drop: ["ALL"], add: ["SETUID", "SETGID", "CHOWN", "KILL"] }

defaultPodOptions:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    fsGroupChangePolicy: OnRootMismatch

service:
  app:
    controller: radicale
    ports:
      http:
        port: &port 5232

persistence:
  data:
    existingClaim: radicale-data-a
    globalMounts:
      - path: /data

route:
  app:
    hostnames:
      - calendar.devpi.de
      - contacts.devpi.de
    parentRefs:
      - name: web-internal
        namespace: cilium
        sectionName: https
    rules:
      - backendRefs:
          - name: radicale
            port: *port
        matches:
          - path:
              type: PathPrefix
              value: /
